<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Incoming Mobile Sales Table - Bootstrap</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/perf-table.css" />
    <!-- Modal CSS -->
    <link rel="stylesheet" href="assets/css/merchant-modal.css" />
    <link rel="stylesheet" href="assets/css/pemol-modal.css" />
  </head>

  <body class="body-rsm">
    <div class="card-rsm">
      <!-- TOP BAR -->
      <div
        class="d-flex align-items-center justify-content-between rsm-top-bar"
      >
        <div class="d-flex align-items-center gap-3">
          <!-- search -->
          <div class="input-group rsm-search-input">
            <span class="input-group-text">üîç</span>
            <input type="text" class="form-control" placeholder="Cari" />
          </div>
        </div>

        <!-- export -->
        <button
          id="btnOpenInputData"
          class="btn d-flex align-items-center gap-2 px-4 py-2 btn-export-rsm btn-export-trigger"
        >
          ‚¨á
          <span>Input data</span>
        </button>
      </div>

      <!-- INPUT DATA MODAL CONTAINER -->
      <div id="inputDataModalContainer"></div>
      <script>
        fetch("assets/partials/components/input_data_modal.html")
          .then((r) => r.text())
          .then((html) => {
            const container = document.getElementById(
              "inputDataModalContainer"
            );
            if (container) {
              container.innerHTML = html;

              // Re-execute scripts
              container.querySelectorAll("script").forEach((s) => {
                const ns = document.createElement("script");
                ns.textContent = s.textContent;
                document.body.appendChild(ns);
              });

              // Attach trigger listener
              const btn = document.getElementById("btnOpenInputData");
              if (btn) {
                btn.addEventListener("click", function () {
                  if (window.openInputDataModal) {
                    window.openInputDataModal();
                  } else {
                    // Fallback if script hasn't run yet or scope issue
                    const modal = document.getElementById("inputDataModal");
                    if (modal) modal.classList.add("show");
                  }
                });
              }
            }
          });
      </script>

      <!-- TABLE -->
      <div class="table-responsive">
        <table class="table mb-0 rsm-table text-nowrap">
          <thead>
            <tr class="align-middle">
              <th rowspan="2" class="text-center" style="width: 50px">No</th>
              <th colspan="2" class="text-center">Candidate</th>
              <th rowspan="2" class="text-center">Area</th>
              <th rowspan="2" class="text-center">Product</th>
              <th rowspan="2" class="text-center">Position</th>
              <th rowspan="2" class="text-center">Level</th>
              <th colspan="2" class="text-center">Upliner</th>
              <th rowspan="2" class="text-center">Status</th>
              <th rowspan="2" class="text-center">Notes Return</th>
            </tr>
            <tr>
              <th class="text-center">Name</th>
              <th class="text-center">ID</th>
              <th class="text-center">Name</th>
              <th class="text-center">NIK</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-center">1</td>
              <td class="rsm-name-cell">Ramaldo Oktama</td>
              <td class="text-center">K1104148</td>
              <td class="text-center">Jakarta</td>
              <td class="text-center">CC</td>
              <td class="text-center">Sales</td>
              <td class="text-center">Staff</td>
              <td class="text-center">Budi</td>
              <td class="text-center">N123456</td>
              <td class="text-center">
                <span class="badge bg-success">Active</span>
              </td>
              <td class="text-center">-</td>
            </tr>
            <tr>
              <td class="text-center">2</td>
              <td class="rsm-name-cell">Asep Syaefudin</td>
              <td class="text-center">K1200215</td>
              <td class="text-center">Bandung</td>
              <td class="text-center">PL</td>
              <td class="text-center">SPV</td>
              <td class="text-center">Supervisor</td>
              <td class="text-center">Dika</td>
              <td class="text-center">N654321</td>
              <td class="text-center">
                <span class="badge bg-danger">Return</span>
              </td>
              <td class="text-center">Foto KTP Buram</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- FOOTER / PAGINATION -->
      <div class="rsm-pagination-component-container"></div>

      <script>
        // Load Pagination
        fetch("assets/partials/components/pagination.html")
          .then((response) => response.text())
          .then((html) => {
            document
              .querySelectorAll(".rsm-pagination-component-container")
              .forEach((container) => {
                if (container.innerHTML.trim() === "") {
                  container.innerHTML = html;
                }
              });
          });
      </script>

      <!-- Container for the Modal Partial -->
      <div id="candidateDetailsModalContainer"></div>

      <script>
        // Load the modal partial dynamically
        fetch("assets/partials/candidate_details_modal.html")
          .then((r) => r.text())
          .then((html) => {
            const container = document.getElementById(
              "candidateDetailsModalContainer"
            );
            if (!container) return;

            // Cleanup existing elements if they exist (to exist reuse issues)
            [
              "merchantDetailModal",
              "downlineModal",
              "merchantDetailModalDownline",
              "downlineTableModal",
              "edcCreditModal",
              "merchantActionTemplate",
            ].forEach((id) => {
              const el = document.getElementById(id);
              if (el) el.remove();
            });

            container.innerHTML = html;

            // Move ALL modals and templates to body
            // Select specifically by IDs we know, or all children that are modals/templates
            const idsToMove = [
              "#merchantDetailModal",
              "#downlineModal",
              "#merchantDetailModalDownline",
              "#downlineTableModal",
              "#edcCreditModal",
              "#merchantActionTemplate",
            ];

            idsToMove.forEach((selector) => {
              const el = container.querySelector(selector);
              if (el) document.body.appendChild(el);
            });

            // Execute scripts in partial
            const scripts = container.querySelectorAll("script");
            scripts.forEach((s) => {
              const ns = document.createElement("script");
              ns.textContent = s.textContent;
              document.body.appendChild(ns);
            });
          });
      </script>
    </div>
  </body>
</html>
