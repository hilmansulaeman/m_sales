<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Application Check Personal Loan</title>

  <link rel="stylesheet" href="assets/css/cross-browser-reset.css" />
  <link rel="stylesheet" href="assets/css/browser-consistency.css" />

  <link rel="stylesheet" href="assets/css/base.css" />
  <link rel="stylesheet" href="assets/css/layout.css" />

  <link rel="stylesheet" href="assets/css/sidebar.css" />
  <link rel="stylesheet" href="assets/css/navbar.css" />
  <link rel="stylesheet" href="assets/css/components.css" />
  <link rel="stylesheet" href="assets/css/pemol-modal.css" />

  <link rel="stylesheet" href="assets/css/custom.css" />
  <link rel="stylesheet" href="assets/css/merchant-table.css" />
  <link rel="stylesheet" href="assets/css/application-check.css" />
  <link rel="stylesheet" href="assets/css/perf-table.css" />
</head>

<body>
  <div id="ms-sidebar-container" aria-hidden="false" style="display: contents"></div>

  <div class="page-content">
    <header class="ms-navbar">
      <div class="ms-title">Application Check Personal Loan</div>
    </header>

    <main class="page-main">
      <div class="app-check-hero">
        <h2 class="app-check-title" style="color: #ffffff">
          Please enter your Name / ID Card Number in the field below
        </h2>
        <div class="sales-select-btn">
          <div class="sales-select-label">Select Sales</div>
        </div>
      </div>
      <div style="display: flex; flex-direction: column; gap: 24px;">
        <div class="rsm-search-component-container team-perf-search"></div>
        <div id="app-check-table-container"></div>
      </div>
      <style>
        .team-perf-search .asm-search {
          width: 864px !important;
          max-width: 100%;
        }

        @media (max-width: 900px) {
          .team-perf-search .asm-search {
            margin-top: 24px;
          }
        }
      </style>
    </main>
  </div>

  <script>
    (function () {
      // Function to load table based on tab
      function loadTable(partialName) {
        var container = document.getElementById("app-check-table-container");
        if (!container) return;

        // Clear current content
        container.innerHTML = "Loading...";

        fetch("assets/partials/" + partialName)
          .then(function (resp) {
            if (!resp.ok) throw new Error("Network error");
            return resp.text();
          })
          .then(function (html) {
            try {
              var parser = new DOMParser();
              var doc = parser.parseFromString(html, "text/html");

              // A. Inject CSS from Partial Header
              var links = doc.querySelectorAll('link[rel="stylesheet"]');
              links.forEach(function (link) {
                var href = link.getAttribute("href");
                if (!href) return;
                // Prevent duplicate CSS loading
                if (
                  !document.head.querySelector('link[href="' + href + '"]')
                ) {
                  var newLink = document.createElement("link");
                  newLink.rel = "stylesheet";
                  newLink.href = href;
                  document.head.appendChild(newLink);
                }
              });

              // B. Copy Classes & Styles from Partial Body
              var wrapper = doc.querySelector(".body-rsm"); // Looks for the class in the partial
              if (wrapper) {
                wrapper.classList.forEach(function (c) {
                  if (!container.classList.contains(c))
                    container.classList.add(c);
                });
                if (wrapper.getAttribute("style")) {
                  container.setAttribute(
                    "style",
                    wrapper.getAttribute("style")
                  );
                }
              }

              // C. Inject HTML Content
              container.innerHTML = doc.body.innerHTML;

              // D. Execute Scripts from Partial
              var scripts = container.querySelectorAll("script");
              scripts.forEach(function (s) {
                var newScript = document.createElement("script");
                if (s.src) {
                  newScript.src = s.src;
                } else {
                  newScript.textContent = s.textContent;
                }
                document.body.appendChild(newScript);
                s.remove(); // Clean up old script tag
              });
            } catch (err) {
              console.error("Error parsing partial:", err);
              container.innerHTML = "Error loading table";
            }
          })
          .catch(function (err) {
            console.error("Failed to load table partial:", err);
            container.innerHTML = "Failed to load table";
          });
      }

      // Initial load (default tab)
      loadTable("team_performance_table.html");

      // Tab switching logic
      var root = document.getElementById("preview-seg");
      if (root) {
        root.addEventListener("click", function (e) {
          var btn = e.target.closest(".seg-item");
          if (!btn) return;

          var items = root.querySelectorAll(".seg-item");
          items.forEach(function (it) {
            it.classList.remove("active");
            it.setAttribute("aria-selected", "false");
          });

          btn.classList.add("active");
          btn.setAttribute("aria-selected", "true");

          // Load appropriate table based on data-tab attribute
          var tab = btn.getAttribute("data-tab");
          if (tab === "duplicate") {
            loadTable("application_check_pl_table_2.html");
          } else {
            loadTable("application_check_pl_table.html");
          }
        });
      }
    })();
  </script>

  <script>
    (function () {
      var container = document.getElementById("ms-sidebar-container");
      if (!container) return;

      fetch("assets/partials/sidebar.html")
        .then(function (resp) {
          if (!resp.ok) throw new Error("Network error");
          return resp.text();
        })
        .then(function (html) {
          container.innerHTML = html;

          // A. Initialize sidebar dropdowns
          try {
            var sidebar = container.querySelector(".ms-sidebar"); // Ensure we select inside container
            if (!sidebar) sidebar = container; // Fallback

            var toggles = sidebar.querySelectorAll(".ms-item--has-submenu");

            toggles.forEach(function (a) {
              a.addEventListener("click", function (e) {
                e.preventDefault();
                var submenu = a.nextElementSibling;
                if (!submenu || !submenu.classList.contains("ms-submenu"))
                  return;

                var expanded = a.getAttribute("aria-expanded") === "true";

                // Close siblings (Accordion effect)
                var siblings = sidebar.querySelectorAll(
                  ".ms-item--has-submenu"
                );
                siblings.forEach(function (s) {
                  if (s !== a) {
                    s.setAttribute("aria-expanded", "false");
                    var sibSub = s.nextElementSibling;
                    if (sibSub && sibSub.classList.contains("ms-submenu")) {
                      sibSub.style.display = "none";
                      sibSub.setAttribute("aria-hidden", "true");
                      s.classList.remove("ms-item--open");
                    }
                  }
                });

                // Toggle current
                if (!expanded) {
                  submenu.style.display = "block";
                  submenu.setAttribute("aria-hidden", "false");
                  a.setAttribute("aria-expanded", "true");
                  a.classList.add("ms-item--open");
                } else {
                  submenu.style.display = "none";
                  submenu.setAttribute("aria-hidden", "true");
                  a.setAttribute("aria-expanded", "false");
                  a.classList.remove("ms-item--open");
                }
              });
            });
          } catch (err) {
            console.error(err);
          }

          // B. Initialize Mobile Toggle (Hamburger)
          try {
            var mobileToggle = container.querySelector(".ms-mobile-toggle");
            var sidebarEl = container.querySelector(".ms-sidebar");

            if (mobileToggle && sidebarEl) {
              mobileToggle.addEventListener("click", function () {
                sidebarEl.classList.toggle("open");
              });

              // Close sidebar when clicking outside on mobile
              document.addEventListener("click", function (e) {
                if (window.innerWidth > 992) return; // Only mobile
                if (
                  !sidebarEl.contains(e.target) &&
                  !mobileToggle.contains(e.target) &&
                  sidebarEl.classList.contains("open")
                ) {
                  sidebarEl.classList.remove("open");
                }
              });
            }
          } catch (err) {
            console.error("Mobile toggle init error:", err);
          }
        })
        .catch(function (err) {
          console.error("Failed to load sidebar:", err);
          container.innerHTML = "";
        });
    })();
  </script>
  <script>
    // Load Search Component
    fetch("assets/partials/components/search.html")
      .then((response) => response.text())
      .then((html) => {
        document
          .querySelectorAll(".rsm-search-component-container")
          .forEach((container) => {
            if (container.innerHTML.trim() === "") {
              container.innerHTML = html;
            }
          });
      });
  </script>
  <div id="rsm-modal-container"></div>
  <script>
    // Global Modal Functions
    window.openRsmModal = function () {
      var modal = document.getElementById("rsmModalPemol");
      if (modal) {
        modal.classList.add("is-open");
      } else {
        console.error("Modal element 'rsmModalPemol' not found!");
      }
    };

    window.closeRsmModal = function () {
      var modal = document.getElementById("rsmModalPemol");
      if (modal) {
        modal.classList.remove("is-open");
      }
    };

    // Global Event Delegation for Modal Closing
    document.addEventListener("click", function (e) {
      // Close button
      if (
        e.target.closest("#closeRsmModalBtn") ||
        e.target.closest(".asm-modal-close")
      ) {
        window.closeRsmModal();
      }
      // Backdrop click
      if (e.target.id === "rsmModalPemol") {
        window.closeRsmModal();
      }
    });

    // Load Team Performance Modal
    fetch("assets/partials/team_performance_modal.html")
      .then((response) => response.text())
      .then((html) => {
        const container = document.getElementById("rsm-modal-container");
        if (container) {
          container.innerHTML = html;
        }
      })
      .catch((err) => console.error("Failed to load modal:", err));
  </script>

  <script>
    // Load Search Component
    fetch('assets/partials/components/search.html')
      .then(response => response.text())
      .then(html => {
        document.querySelectorAll('.rsm-search-component-container').forEach(container => {
          if (container.innerHTML.trim() === '') {
            container.innerHTML = html;
          }
        });
      });
  </script>
</body>

</html>