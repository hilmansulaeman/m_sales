<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Duplicate Check</title>

    <link rel="stylesheet" href="assets/css/cross-browser-reset.css" />
    <link rel="stylesheet" href="assets/css/browser-consistency.css" />

    <link rel="stylesheet" href="assets/css/base.css" />
    <link rel="stylesheet" href="assets/css/layout.css" />

    <link rel="stylesheet" href="assets/css/sidebar.css" />
    <link rel="stylesheet" href="assets/css/navbar.css" />
    <link rel="stylesheet" href="assets/css/components.css" />
    <link rel="stylesheet" href="assets/css/pemol-modal.css" />

    <link rel="stylesheet" href="assets/css/custom.css" />
    <link rel="stylesheet" href="assets/css/merchant-table.css" />
    <link rel="stylesheet" href="assets/css/duplicate_check.css" />
  </head>

  <body>
    <div
      id="ms-sidebar-container"
      aria-hidden="false"
      style="display: contents"
    ></div>

    <div class="page-content">
      <header class="ms-navbar">
        <button class="ms-navbar-toggle">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
        <div class="ms-title">Duplicate Check</div>
      </header>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          var toggle = document.querySelector(".ms-navbar-toggle");
          if (toggle) {
            toggle.addEventListener("click", function () {
              var sidebar = document.querySelector(".ms-sidebar");
              if (sidebar) sidebar.classList.toggle("open");
            });
            document.addEventListener("click", function (e) {
              var sidebar = document.querySelector(".ms-sidebar");
              if (
                sidebar &&
                sidebar.classList.contains("open") &&
                !sidebar.contains(e.target) &&
                !toggle.contains(e.target)
              ) {
                sidebar.classList.remove("open");
              }
            });
          }
        });
      </script>

      <main class="page-main">
        <!-- Segmented Control -->
        <div
          id="preview-seg"
          class="segmented app-check-segmented"
          role="tablist"
          aria-label="Data Type Selection"
        >
          <div class="segmented-inner">
            <button
              type="button"
              role="tab"
              aria-selected="true"
              class="seg-item active app-check-seg-item"
              data-tab="name_dob"
            >
              <span class="label">Name & DOB</span>
            </button>
            <button
              type="button"
              role="tab"
              aria-selected="false"
              class="seg-item app-check-seg-item"
              data-tab="id_number"
            >
              <span class="label">ID Number</span>
            </button>
          </div>
        </div>

        <!-- Info Box -->
        <div class="dup-check-info-box" data-property-1="INFO DOB">
          <div class="dup-check-info-content">
            <div class="dup-check-info-row">
              <div class="dup-check-icon-bg"></div>
              <div class="dup-check-icon-fg"></div>
              <div class="dup-check-info-text">
                Duplicate data can be verified using either Name and Date of
                Birth or National ID Number (KTP)
              </div>
            </div>
          </div>
          <div class="dup-check-dismiss-btn">
            <div class="dup-check-dismiss-text">Dismiss</div>
          </div>
        </div>
        <div id="duplicate-check-table-container"></div>
      </main>
    </div>

    <script>
      (function () {
        // Function to load table based on tab
        function loadTable(partialName) {
          var container = document.getElementById(
            "duplicate-check-table-container"
          );
          if (!container) return;

          // Clear current content
          container.innerHTML = "Loading...";

          fetch("assets/partials/" + partialName)
            .then(function (resp) {
              if (!resp.ok) throw new Error("Network error");
              return resp.text();
            })
            .then(function (html) {
              try {
                var parser = new DOMParser();
                var doc = parser.parseFromString(html, "text/html");

                // A. Inject CSS from Partial Header
                var links = doc.querySelectorAll('link[rel="stylesheet"]');
                links.forEach(function (link) {
                  var href = link.getAttribute("href");
                  if (!href) return;
                  // Prevent duplicate CSS loading
                  if (
                    !document.head.querySelector('link[href="' + href + '"]')
                  ) {
                    var newLink = document.createElement("link");
                    newLink.rel = "stylesheet";
                    newLink.href = href;
                    document.head.appendChild(newLink);
                  }
                });

                // B. Copy Classes & Styles from Partial Body
                var wrapper = doc.querySelector(".body-rsm"); // Looks for the class in the partial
                if (wrapper) {
                  wrapper.classList.forEach(function (c) {
                    if (!container.classList.contains(c))
                      container.classList.add(c);
                  });
                  if (wrapper.getAttribute("style")) {
                    container.setAttribute(
                      "style",
                      wrapper.getAttribute("style")
                    );
                  }
                }

                // C. Inject HTML Content
                container.innerHTML = doc.body.innerHTML;

                // D. Execute Scripts from Partial
                var scripts = container.querySelectorAll("script");
                scripts.forEach(function (s) {
                  var newScript = document.createElement("script");
                  if (s.src) {
                    newScript.src = s.src;
                  } else {
                    newScript.textContent = s.textContent;
                  }
                  document.body.appendChild(newScript);
                  s.remove(); // Clean up old script tag
                });
              } catch (err) {
                console.error("Error parsing partial:", err);
                container.innerHTML = "Error loading table";
              }
            })
            .catch(function (err) {
              console.error("Failed to load table partial:", err);
              container.innerHTML = "Failed to load table";
            });
        }

        // Initial load (default tab)
        loadTable("duplicate_check_table.html");

        // Tab switching logic
        var root = document.getElementById("preview-seg");
        if (root) {
          root.addEventListener("click", function (e) {
            var btn = e.target.closest(".seg-item");
            if (!btn) return;

            var items = root.querySelectorAll(".seg-item");
            items.forEach(function (it) {
              it.classList.remove("active");
              it.setAttribute("aria-selected", "false");
            });

            btn.classList.add("active");
            btn.setAttribute("aria-selected", "true");

            // Load appropriate table based on data-tab attribute
            var tab = btn.getAttribute("data-tab");
            if (tab === "id_number") {
              loadTable("duplicate_check_id_table.html");
            } else {
              // name_dob
              loadTable("duplicate_check_table.html");
            }
          });
        }
      })();
    </script>

    <script>
      (function () {
        var container = document.getElementById("ms-sidebar-container");
        if (!container) return;

        fetch("assets/partials/sidebar.html")
          .then(function (resp) {
            if (!resp.ok) throw new Error("Network error");
            return resp.text();
          })
          .then(function (html) {
            container.innerHTML = html;

            // Initialize sidebar dropdowns
            try {
              var sidebar = container;
              var toggles = sidebar.querySelectorAll(".ms-item--has-submenu");

              toggles.forEach(function (a) {
                a.addEventListener("click", function (e) {
                  e.preventDefault();
                  var submenu = a.nextElementSibling;
                  if (!submenu || !submenu.classList.contains("ms-submenu"))
                    return;

                  var expanded = a.getAttribute("aria-expanded") === "true";

                  // Close siblings (Accordion effect)
                  var siblings = sidebar.querySelectorAll(
                    ".ms-item--has-submenu"
                  );
                  siblings.forEach(function (s) {
                    if (s !== a) {
                      s.setAttribute("aria-expanded", "false");
                      var sibSub = s.nextElementSibling;
                      if (sibSub && sibSub.classList.contains("ms-submenu")) {
                        sibSub.style.display = "none";
                        sibSub.setAttribute("aria-hidden", "true");
                        s.classList.remove("ms-item--open");
                      }
                    }
                  });

                  // Toggle current
                  if (!expanded) {
                    submenu.style.display = "block";
                    submenu.setAttribute("aria-hidden", "false");
                    a.setAttribute("aria-expanded", "true");
                    a.classList.add("ms-item--open");
                  } else {
                    submenu.style.display = "none";
                    submenu.setAttribute("aria-hidden", "true");
                    a.setAttribute("aria-expanded", "false");
                    a.classList.remove("ms-item--open");
                  }
                });
              });
            } catch (err) {
              console.error(err);
            }
          })
          .catch(function (err) {
            console.error("Failed to load sidebar:", err);
            container.innerHTML = "";
          });
      })();
    </script>
    <script>
      // Load Search Component
      fetch("assets/partials/components/search.html")
        .then((response) => response.text())
        .then((html) => {
          document
            .querySelectorAll(".rsm-search-component-container")
            .forEach((container) => {
              if (container.innerHTML.trim() === "") {
                container.innerHTML = html;
              }
            });
        });
    </script>
  </body>
</html>
